webpackJsonp([17],{B7hf:function(t,e){},"D2+a":function(t,e){},SUyR:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAADqADAAQAAAABAAAADgAAAAC98Dn6AAABbUlEQVQoFZ1SvUrDUBTujUmopSqIIlhwdHJwcXIJuvoERZEkNXkBwUUcxEHwATQ/GIKP4Av0FYpj3aLiUs0U0vz6nVBLSDL1wOF85+e795x7Lms1iG3bZ2maXiPV4TjOHQwGN4yxrFzKlx3CpmkeZFnmovAB7hfwHWKfwI+U/xfmOE47juOLPM8ZBUE4Bj4EvJ0VnSPGAT+Tj1wO88Isy9oCfoNuouAHNqGCBiHyBnSC9o+KW1zX7YVh+CGK4q4sy+MGUgtzr2PuCc/z+6qqjmozGoaxhgOmgiDAiHG32808z2tXD6sR0e59FEXv0J0gCL593w9A2oNelck1IpKditKDLZdJhGnghWRhYq1VrMNHC79ob3WGaUYfj8XwqvPuCiJWMaUIHmQF5lLTtGQ4HC5JkkTfLMfP4fFJtqkmSZKittgjBZCk/Y2gT+RXBbf30cUJbE/X9XjeKhZ7ilNtJF+rJPIR91DTVxQlJv8P3z6Zosx3/c4AAAAASUVORK5CYII="},VWAz:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("XSZv"),o={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.report.loading,expression:"report.loading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{id:"report_create"}},[r("div",{staticClass:"r_top"},[t._m(0),t._v(" "),r("el-form",{staticClass:"r_content_main"},[r("el-row",{staticClass:"r_main_list",attrs:{type:"flex"}},[r("el-col",{attrs:{span:3}},[r("span",{staticClass:"title"},[t._v("时间范围")])]),t._v(" "),r("el-col",{attrs:{span:21}},[r("div",{staticClass:"r_time"},[r("vm-emerge-picker",{on:{changeTime:t.changeTime}})],1)])],1),t._v(" "),r("el-row",{staticClass:"r_main_list",attrs:{type:"flex"}},[r("el-col",{attrs:{span:3}},[r("span",{staticClass:"title"},[t._v("发送格式")])]),t._v(" "),r("el-col",{attrs:{span:21}},[r("div",{staticClass:"r_radio"},[r("el-radio",{staticClass:"r_radio_item",attrs:{label:"csv"},model:{value:t.report.type,callback:function(e){t.$set(t.report,"type",e)},expression:"report.type"}},[t._v("Excel")]),t._v(" "),r("el-radio",{staticClass:"r_radio_item",attrs:{label:"doc"},model:{value:t.report.type,callback:function(e){t.$set(t.report,"type",e)},expression:"report.type"}},[t._v("Word")]),t._v(" "),r("el-radio",{staticClass:"r_radio_item",attrs:{label:"pdf"},model:{value:t.report.type,callback:function(e){t.$set(t.report,"type",e)},expression:"report.type"}},[t._v("PDF")])],1)])],1),t._v(" "),r("el-row",{staticClass:"r_main_list r_special_list",attrs:{type:"flex"}},[r("el-col",{attrs:{span:3}},[r("span",{staticClass:"title"},[t._v("报表名称")])]),t._v(" "),r("el-col",{attrs:{span:21}},[r("el-input",{staticClass:"report-input",attrs:{placeholder:"请输入报表名称",clearable:""},model:{value:t.report.name,callback:function(e){t.$set(t.report,"name",e)},expression:"report.name"}})],1),t._v(" "),r("div",{staticClass:"r_btn_group"},[r("el-button",{staticClass:"b_btn b_ok",on:{click:t.create}},[t._v("确定")]),t._v(" "),r("el-button",{staticClass:"b_btn b_cancel",on:{click:t.reseet}},[t._v("取消")])],1)],1)],1)],1),t._v(" "),r("div",{staticClass:"r_bottom"},[r("el-row",{staticClass:"common-table-pattern"},[r("el-col",{attrs:{span:24}},[r("el-table",{ref:"multipleTable",staticClass:"reset_table",staticStyle:{width:"100%"},attrs:{align:"center",border:"",data:t.report_lsit.data},on:{"selection-change":t.handleSelectionChange}},[r("el-table-column",{attrs:{label:"序号",align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s((t.report_data.page-1)*t.report_data.rows+e.row.index_cn)+"\n            ")]}}])}),t._v(" "),r("el-table-column",{attrs:{prop:"create_time",align:"center",label:"日期"}}),t._v(" "),r("el-table-column",{attrs:{prop:"report_name",align:"center",label:"名称"}}),t._v(" "),r("el-table-column",{attrs:{label:"时间范围",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",[t._v(t._s(e.row.stime))]),t._v(" "),r("span",[t._v("至")]),t._v(" "),r("span",[t._v(t._s(e.row.etime))])]}}])}),t._v(" "),r("el-table-column",{attrs:{prop:"report_type",align:"center",label:"格式"}}),t._v(" "),r("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("img",{staticClass:"img_icon",attrs:{src:a("lfVf"),alt:""},on:{click:function(a){return a.stopPropagation(),t.download(e.row)}}}),t._v(" "),r("img",{staticClass:"img_icon",attrs:{src:a("SUyR"),alt:""},on:{click:function(a){return a.stopPropagation(),t.del_box(e.row)}}})]}}])})],1)],1),t._v(" "),r("el-col",{staticClass:"e-pagination",attrs:{span:24}},[r("el-pagination",{staticStyle:{"margin-top":"24px"},attrs:{"current-page":t.report_lsit.pageNow,"page-sizes":[10,20,50,100],"page-size":10,layout:"total, sizes, prev, pager, next",total:t.report_lsit.count},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)],1),t._v(" "),t._m(1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"r_content_top"},[e("h3",{staticClass:"title"},[this._v("报表生成")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"echarts"},[e("div",{attrs:{id:"untreatedalarm_report"}}),this._v(" "),e("div",{attrs:{id:"application_protocol"}}),this._v(" "),e("div",{attrs:{id:"alert_trend"}}),this._v(" "),e("div",{attrs:{id:"alert_type"}})])}]};var i=function(t){a("D2+a"),a("B7hf")},s=a("VU/8")(r.a,o,!1,i,"data-v-5aca0c76",null);e.default=s.exports},XSZv:function(t,e,a){"use strict";(function(t){var r=a("zQWo"),o=a("5Xf9");e.a={name:"report_create",data:function(){return{report:{name:"",type:"csv",start_time:"",end_time:"",loading:!1},report_data:{page:1,rows:10},report_lsit:{},untreatedAlarm_data:{low_total_count:0,medium_total_count:0,high_total_count:0,base64:""},application_protocol_data:{application_protocol_name:[],application_protocol_value:[],base64:""},alert_trend_data:{alert_trend_name:[],alert_trend_value:[],base64:""},alert_type_data:{alert_type_name:[],alert_type_value:[],base64:""}}},components:{VmEmergePicker:r.a},mounted:function(){this.get_data(),this.check_passwd()},methods:{check_passwd:function(){var t=this;this.$axios.get("/yiiapi/site/check-passwd-reset").then(function(e){var a=e.data,r=a.status,i=a.msg;a.data;if(0!=r)for(var s in i)600==s&&t.$message({message:i[s],type:"warning"}),602==s&&(t.$message({message:i[s],type:"warning"}),o.a.$emit("reset"))})},create:function(){var t=this;return console.log(this.report),""==this.report.name?(this.$message({message:"请输入报表名称",type:"warning"}),!1):""==this.report.start_time||""==this.report.end_time?(this.$message({message:"请选择时间范围！",type:"warning"}),!1):(this.report.loading=!0,"doc"==this.report.type&&this.$axios.get("/yiiapi/report/create-echarts-img",{params:{stime:this.report.start_time,etime:this.report.end_time,report_name:this.report.name,report_type:"doc"}}).then(function(e){var a=e.data,r=(a.status,a.data);console.log(r),r.threat_level&&t.untreatedAlarm(r.threat_level),r.threat_protocol&&t.application_protocol(r.threat_protocol),r.alert_trend&&t.alert_trend(r.alert_trend),r.alert_type&&t.alert_type(r.alert_type),setTimeout(function(){t.$axios.post("/yiiapi/report/create-report",{stime:t.report.start_time,etime:t.report.end_time,report_name:t.report.name,report_type:"doc",threat_level:t.untreatedAlarm_data.base64,threat_protocol:t.application_protocol_data.base64,alert_type:t.alert_type_data.base64,alert_trend:t.alert_trend_data.base64}).then(function(e){t.report.loading=!1;var a=e.data,r=a.status,o=(a.data,a.msg),i=a.message;switch(r){case 0:t.get_data(),t.$message({message:"报表生成成功",type:"success"});break;case 500:t.$message({message:i,type:"warning"});break;default:t.$message({message:o,type:"warning"})}}).catch(function(t){console.log(t)})},100)}).catch(function(t){console.log(t)}),"pdf"==this.report.type&&this.$axios.get("/yiiapi/report/create-echarts-img",{params:{stime:this.report.start_time,etime:this.report.end_time,report_name:this.report.name,report_type:"pdf"}}).then(function(e){var a=e.data,r=(a.status,a.data);console.log(r),r.threat_level&&t.untreatedAlarm(r.threat_level),r.threat_protocol&&t.application_protocol(r.threat_protocol),r.alert_trend&&t.alert_trend(r.alert_trend),r.alert_type&&t.alert_type(r.alert_type),setTimeout(function(){t.$axios.post("/yiiapi/report/create-report",{stime:t.report.start_time,etime:t.report.end_time,report_name:t.report.name,report_type:"pdf",threat_level:t.untreatedAlarm_data.base64,threat_protocol:t.application_protocol_data.base64,alert_type:t.alert_type_data.base64,alert_trend:t.alert_trend_data.base64}).then(function(e){t.report.loading=!1;var a=e.data,r=a.status,o=(a.data,a.msg);0==r?(t.get_data(),t.$message({message:"报表生成成功",type:"success"})):t.$message({message:o,type:"warning"})}).catch(function(t){console.log(t)})},100)}).catch(function(t){console.log(t)}),void("csv"==this.report.type&&this.$axios.post("/yiiapi/report/create-report",{stime:this.report.start_time,etime:this.report.end_time,report_name:this.report.name,report_type:"csv"}).then(function(e){t.report.loading=!1;var a=e.data,r=a.status,o=(a.data,a.msg);0==r?(t.get_data(),t.$message({message:"报表生成成功!",type:"success"})):t.$message({message:o,type:"warning"})}).catch(function(t){console.log(t)})))},untreatedAlarm:function(t){var e=this;0==t.length?(this.untreatedAlarm_data.low_total_count=0,this.untreatedAlarm_data.medium_total_count=0,this.untreatedAlarm_data.high_total_count=0):t.forEach(function(t){"low"==t.degree?e.untreatedAlarm_data.low_total_count=t.total_count:"medium"==t.degree?e.untreatedAlarm_data.medium_total_count=t.total_count:"high"==t.degree&&(e.untreatedAlarm_data.high_total_count=t.total_count)});var a=this.$echarts.init(document.getElementById("untreatedalarm_report")),r={tooltip:{trigger:"item",formatter:"{b}:{c}({d}%)"},grid:{show:!0,left:"center",right:"center",top:"center",bottom:"center"},series:[{name:"未处理告警",type:"pie",animation:!1,radius:"60%",center:["50%","50%"],hoverAnimation:!1,hoverOffset:0,selectedMode:"single",data:[{value:this.untreatedAlarm_data.high_total_count,name:"高危",itemStyle:{normal:{color:"#962116"}}},{value:this.untreatedAlarm_data.medium_total_count,name:"中危",itemStyle:{normal:{color:"#F5BF41"}}},{value:this.untreatedAlarm_data.low_total_count,name:"低危",itemStyle:{normal:{color:"#4AA46E"}}}],itemStyle:{normal:{label:{show:!0,formatter:"{b} : {c} \n ({d}%)"},labelLine:{show:!0}},emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};a.setOption(r),this.untreatedAlarm_data.base64=a.getDataURL()},application_protocol:function(t){var e=this;this.application_protocol_data.application_protocol_name=[],this.application_protocol_data.application_protocol_value=[],t.forEach(function(t){e.application_protocol_data.application_protocol_name.push(t.application),e.application_protocol_data.application_protocol_value.push(t.count)});var a=this.$echarts.init(document.getElementById("application_protocol")),r={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",top:"5%",containLabel:!0},xAxis:{type:"category",data:this.application_protocol_data.application_protocol_name,axisTick:{show:!1},axisLabel:{interval:0,rotate:"60",margin:5,textStyle:{fontSize:16}}},yAxis:[{type:"value",axisTick:{show:!1},axisLabel:{margin:3,textStyle:{fontSize:16}}}],series:[{type:"bar",barMaxWidth:20,animation:!1,stack:"搜索引擎",itemStyle:{normal:{barBorderRadius:[4,4,4,4],color:"rgba(150,33,22,.8)"}},data:this.application_protocol_data.application_protocol_value}]};a.setOption(r),this.application_protocol_data.base64=a.getDataURL()},alert_trend:function(t){var e=this;console.log(t),this.alert_trend_data.alert_trend_name=[],this.alert_trend_data.alert_trend_value=[],t.forEach(function(t){e.alert_trend_data.alert_trend_name.push(t.date_time),e.alert_trend_data.alert_trend_value.push(t.count-0)}),console.log(this.alert_trend_data);var a=this.$echarts.init(document.getElementById("alert_trend")),r={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",top:"5%",containLabel:!0},xAxis:{type:"category",data:this.alert_trend_data.alert_trend_name,axisTick:{show:!1},axisLabel:{rotate:"60",margin:5,textStyle:{fontSize:16}}},yAxis:[{type:"value",axisTick:{show:!1},axisLabel:{margin:5,textStyle:{fontSize:16}}}],series:[{type:"bar",barMaxWidth:20,animation:!1,stack:"搜索引擎",itemStyle:{normal:{barBorderRadius:[4,4,4,4],color:"rgba(150,33,22,.8)"}},data:this.alert_trend_data.alert_trend_value}]};a.setOption(r),this.alert_trend_data.base64=a.getDataURL()},alert_type:function(t){var e=this;this.alert_type_data.alert_type_name=[],this.alert_type_data.alert_type_value=[],t.forEach(function(t){e.alert_type_data.alert_type_name.push(t.alert_type),e.alert_type_data.alert_type_value.push(t.alert_count)});var a=this.$echarts.init(document.getElementById("alert_type")),r={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",top:"5%",containLabel:!0},xAxis:{type:"category",data:this.alert_type_data.alert_type_name,axisTick:{show:!1},axisLabel:{interval:0,rotate:"60",margin:5,textStyle:{fontSize:16}}},yAxis:[{type:"value",axisTick:{show:!1},axisLabel:{margin:5,textStyle:{fontSize:16}}}],series:[{type:"bar",barMaxWidth:20,animation:!1,stack:"搜索引擎",itemStyle:{normal:{barBorderRadius:[4,4,4,4],color:"rgba(150,33,22,.8)"}},data:this.alert_type_data.alert_type_value}]};a.setOption(r),this.alert_type_data.base64=a.getDataURL()},reseet:function(){this.report.name="",this.report.type="csv",this.report.start_time="",this.report.end_time="",t(document.querySelector(".el-button--text")).trigger("click")},get_data:function(){var t=this;this.$axios.get("/yiiapi/report/list",{params:{page:this.report_data.page,rows:this.report_data.rows}}).then(function(e){var a=e.data,r=a.status,o=a.data;console.log(r),t.report_lsit=o,t.report_lsit.data.forEach(function(t,e){t.index_cn=e+1})}).catch(function(t){console.log(t)})},download:function(t){this.$axios.get("/yiiapi/site/check-auth-exist",{params:{pathInfo:"yararule/download"}}).then(function(e){var a="/yiiapi/report/download-report?id="+t.id;window.location.href=a}).catch(function(t){console.log(t)})},del_box:function(t){var e=this;this.$confirm("此操作删除信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$axios.delete("/yiiapi/report/delete",{data:{id:t.id,report_name:t.report_name}}).then(function(t){var a=t.data,r=a.status;a.data;0==r?(e.get_data(),e.$message({message:"删除成功!",type:"success"})):e.$message({message:"删除失败!",type:"error"})}).catch(function(t){console.log(t)})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},changeTime:function(t){console.log(t),this.report.start_time=parseInt(t[0].valueOf()/1e3),this.report.end_time=parseInt(t[1].valueOf()/1e3)},toggleSelection:function(t){var e=this;t?t.forEach(function(t){e.$refs.multipleTable.toggleRowSelection(t)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(t){},handleSizeChange:function(t){this.report_data.rows=t,this.report_data.page=1,this.get_data()},handleCurrentChange:function(t){this.report_data.page=t,this.get_data()}}}}).call(e,a("7t+N"))},lfVf:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAADqADAAQAAAABAAAADgAAAAC98Dn6AAABSElEQVQoFX2QvUoDURCFzw2roAg+hGBAUBBLETGFrRgUG9FOWzdEC7HYyk7TW/gCggS0ErGxE6zstBK1SxGrSPwZv5tdko3JOpcZ5sycw8xcKctCO1Bo51ntXFaD+mTifSn/CR2KzH5mA5H1HZUUY2Fom9wz94foJ3bbnuXh7cvMxUJTEcY1xaVuZgqVbUpN3VLZ0omCWDiodRa7w8+0YyspepyWbFpfugE08IK23WdnnchG9K5LGrN8yYZ+tEw+g6/hV3id+oKO3DO5OkKPIhtGfMHkeVAdH4BhvFpLdOxePM1bt9BXQhsiViEvegjjkVhQxb21cBJy3PSgkq22ixXX0Kj8J1UR3StgelrkuWgCmhOQxttCn0Tug+hv7DVTHs1YQKfGWkVWfOWOZi8zVTFuNvlfb/iJu4BDwKm+QVnmP8mb6QlW+RcweluVRfJJ8wAAAABJRU5ErkJggg=="}});